#
# Rule format :
#
# For more information about the fields described above and their meaning,
# please have a look to the IDMEF Draft located at :
#
# http://www.silicondefense.com/idwg/draft-ietf-idwg-idmef-xml-07.txt
#
# If one of the IDMEF field you wish to add information too isn't covered in
# the rule language, please take the 5 minutes needed to implement a simple
# parsing function to the simple.c plugin distributed with Prelude LML.
#
#
# - regex:
#   A PCRE regex that should be matched to trigger the alert.
#
# - classification(0).name: 
#   The name of the alert, from one of the origins listed below.
#
# - classification(0).origin:
#   The source from which the name of the alert originates. 
#   Possible values are: unknown, bugtraqid, cve, vendor-specific. Default is unknown.
#
# - classification(0).url:
#   A URL at which the manager (or the human
#   operator of the manager) can find additional information about the
#   alert.  The document pointed to by the URL may include an in-depth
#   description of the attack, appropriate countermeasures, or other
#   information deemed relevant by the vendor.
# 
# - assessment.impact.severity:
#   An estimate of the relative severity of the event.
#   Possible values are: low, medium, high.
#
# - assessment.impact.completion:
#   An indication of whether the analyzer believes the attempt that
#   the event describes was successful or not.
#   The permitted values are: failed, succeeded.
#
# - assessment.impact.type:
#   The type of attempt represented by this event, in relatively broad categories.
#   The permitted values are: admin, dos, file, recon, user, other.
#
# - assessment.impact.description:
#   May contain a textual description of the impact, if the analyzer
#   is able to provide additional details.
#
# - source(0).node.address(0).address:
#   Address that issued the attack.
#   There can be more than one.
# 
# - target(0).node.address(0).address:
#   Address that has been attacked.
#   There can be more than one.
#
# - source(0).node.name,
#   target(0).node.name:
#   The name of the equipment. This information MUST be provided if no Address
#   information is given.
#
# - source(0).node.category,
#   target(0).node.category:
#   The domain from which the name information was obtained.
#   Possible values are: unknow, ads, afs, coda, dfs, dns, hosts, kerberos,
#   nds, nis, nisplus, nt, wfw
#
# - source(0).node.location,
#   target(0).node.location:
#   The location of the equipment.
#
# - source(0).spoofed,
#   target(0).decoy:
#   An indication of wheter the source/target is a decoy.
#   The permitted values are: unknown, yes, no.
#
# - source(0).interface,
#   target(0).interface:
#   May be used by a network-based analyzer with multiple interfaces to
#   indicate which interfaces this source/target was seen on.
#
# - source(0).service.name,
#   target(0).service.name:
#   The name of the service. Whenever possible, the name from the IANA list
#   of well-known ports SHOULD be used.
#
# - source(0).service.port,
#   target(0).service.port:
#   The port number being used.
#
# - source(0).service.protocol,
#   target(0).service.protocol:
#   The protocol being used.
#
# - source(0).service.portlist,
#   target(0).service.portlist:
#   A list of port numbers beeing used.
#
# - source(0).user.category,
#   target(0).user.category:
#   The type of user represented (unknown, application, os-device).
#
# - source(0).user.userid(0).
#   target(0).user.userid(0).
#   Create a new UserId inside an User object (that may contain several UserId).
#
# - source(0).user.userid(0).type,
#   target(0).user.userid(0).type:
#   The type of user information represented (current-user, original-user, target-user,
#   user-privs, current-group, group-privs, other-privs).
#
# - source(0).user.userid(0).name,
#   target(0).user.userid(0).name:
#   A user or group name.
#
# - source(0).user.userid(0).number,
#   target(0).user.userid(0).number:
#   A user or group number.

include = ms-sql.rules;
include = nagios.rules;
include = wu-ftp.rules;
include = cisco.rules;
include = cisco-vpn.rules;
include = cisco-pix.rules;
include = navce.rules;
include = exim.rules;
include = zyxel.rules;
include = ipfw.rules;
include = netfilter.rules;
include = grsecurity.rules;
include = ssh.rules;
include = zywall.rules;
include = proftpd.rules;
include = qpopper.rules;
include = vpopmail.rules;
include = checkpoint.rules;
include = ntsyslog.rules;
include = ipso.rules;
include = squid.rules;
include = portsentry.rules;
include = vigor.rules;
include = ipchains.rules;
include = wap11.rules;
include = honeyd.rules;

#Dec  9 18:47:10 devel5 sshd(pam_unix)[13189]: session opened for user yyyy by xxxx(uid=0)
regex=session opened for user (\S+) by (\S+)\(uid=(\d*)\); \
 classification(0).name=User authentication; \
 id=1; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.completion = succeeded; \
 assessment.impact.type = user; \
 assessment.impact.severity = low; \
 assessment.impact.description = User $2 authenticated to $1 successfuly; \
 source(0).user.category = os-device; \
 source(0).user.userid(0).type = current-user; \
 source(0).user.userid(0).name = $2;  \
 source(0).user.userid(0).number = $3; \
 target(0).user.category = os-device; \
 target(0).user.userid(0).name=$1; \
 target(0).user.userid(0).type = target-user; \
 last
                                                                                                                         
# authentication failure; logname=xxxx uid=xxxx euid=xxxx tty=xxxx ruser=xxxx rhost=xxxx  user=xxxx
regex=authentication failure\; logname=(.*) uid=(.*) euid=(.*) tty=(.*) ruser=(.*) rhost=(.*) user=(.*); \
 classification(0).name = User authentication; \
 id=2; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.completion = failed; \
 assessment.impact.type = user; \
 assessment.impact.severity = high; \
 assessment.impact.description=User $1 tried to authenticate as $7 and failed; \
 source(0).user.category = os-device; \
 source(0).user.userid(0).type = current-user; \
 source(0).user.userid(0).name = $1;           \
 source(0).user.userid(0).number=$2; \
 target(0).user.category = os-device; \
 target(0).user.userid(0).type = target-user; \
 target(0).user.userid(0).name = $7; \
 last

# No log sample; please submit
regex=entered promiscuous mode; \
 classification(0).name=Promiscuous mode detected; \
 id=3; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.completion = succeeded; \
 assessment.impact.type = other; \
 assessment.impact.severity = medium; \
 assessment.impact.description=A sniffer is probably running on this machine; \
 last

# No log sample; please submit
regex=no such user; \
 classification(0).name=Invalid User; \
 id=4; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.completion = failed; \
 assessment.impact.type = other; \
 assessment.impact.severity = medium; \
 assessment.impact.description = Someone tried to log in using a non existing user; \
 last
