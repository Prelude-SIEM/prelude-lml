#####
#
# Copyright (C) 2002 Nicolas Delon <delon.nicolas@wanadoo.fr>
# All Rights Reserved
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by 
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#
#####

#####
#
# Started on  Thu Oct 17 12:01:59 2002
# Last update Fri Oct 25 23:32:44 2002
#
# Version 0.1
#
# Comment: tested with OpenSSH 3.5
#
#####

 
###################
# Logging succeed #
###################

regex=sshd.+: Accepted (\S+) for root from (\S+) port (\d+) ssh2; class.name=SSH Remote root logging; impact.severity = low; impact.completion=succeeded; impact.type=admin; impact.description=Root logging in from $2:$3 using the $1 method; source.node.address.address=$2; target.service.protocol=ssh;
regex=sshd.+: Accepted (\S+) for (?!root)(\S+) from (\S+) port (\d+) ssh2; class.name=SSH Remote user logging; impact.severity = low; impact.completion=succeeded; impact.type=user; impact.description=User $2 logging in from $3:$4 using the $1 method; source.node.address.address=$3; target.service.protocol=ssh;


##################
# Logging failed #
##################

regex=sshd.+: Failed (\S+) for root from (\S+) port (\d+) ssh2; class.name=SSH Remote root logging failed; impact.severity = medium; impact.completion=failed; impact.type=admin; impact.description=Someone try to logging in as root from $2:$3 using the $1 method; source.node.address.address=$2; target.service.protocol=ssh;
regex=sshd.+: Failed (\S+) for (?!root)(\S+) from (\S+) port (\d+) ssh2; class.name=SSH Remote user logging failed; impact.severity = medium; impact.completion=failed; impact.type=user; impact.description=Someone try to logging in as $2 from $3:$4 using the $1 method; source.node.address.address=$3; target.service.protocol=ssh;


#################################################
# Invalid (not existing) user try to logging in #
#################################################

regex=sshd.+: Illegal user (\S+) from (\S+); class.name=SSH Remote logging failed with an invalid user; impact.severity = medium; impact.completion=failed; impact.type=user; impact.description=Someone try to logging in with the invalid user "$1" from $2; source.node.address.address=$2; target.service.protocol=ssh;


#####################################################################################
# User listed in DenyGroups or DenyUsers (sshd_config directives) try to logging in #
#####################################################################################

regex=sshd.+: User (\S+) not allowed because .*listed in (\w+); class.name=SSH Remote logging failed with a denied user; impact.severity = medium; impact.completion=failed; impact.type=user; impact.description=User $1 failed to logging in because he is listed in $2; target.service.protocol=ssh;


##################################################################
# Sshd did not receive the identification string from the client #
# (maybe a ssh server recognition)                               #
##################################################################

regex=sshd.+: Did not receive identification string from (\S+); class.name=SSH Server recognition; impact.severity = medium; impact.completion=failed; impact.type=recon; impact.description=$1 makes probably a server recognition; target.service.protocol=ssh;


#########################################################################
# Forbidden root logging                                                #
# (directive PermitRootLogin and keyword "no" or "forced-commands-only" #
# of the sshd_config file)                                              #
#########################################################################

regex=sshd.+: ROOT LOGIN REFUSED FROM (\w+); class.name=SSH Remote root logging forbidden; impact.severity = medium; impact.completion=failed; impact.type=admin; impact.description=Root try to logging in while it is forbidden; target.service.protocol=ssh;
