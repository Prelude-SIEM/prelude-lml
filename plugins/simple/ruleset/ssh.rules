#####
#
# Copyright (C) 2002 Nicolas Delon <delon.nicolas@wanadoo.fr>
# All Rights Reserved
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by 
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#
#####

#####
#
# Started on  Thu Oct 17 12:01:59 2002
# Last update Fri Oct 25 23:32:44 2002
#
# Version 0.1
#
# Comment: tested with OpenSSH 3.5
#
#####
 
###################
# Logging succeed #
###################

#Dec  8 14:45:17 itguxweb1 sshd[32112]: Accepted publickey for root from 12.34.56.78 port 56634 ssh2
regex=sshd\[\d+\]: Accepted (\S+) for root from ([\d\.]+) port (\d+)\s*(ssh2)?; \
 classification(0).name=SSH Remote root logging; \
 id=1900; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity=low; \
 impact.completion=succeeded; \
 impact.type=admin; \
 impact.description=Root logged in from $2:$3 using the $1 method; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$2; \
 source.service.port=$3; \
 source.service.protocol=tcp; \
# target.node.address.category=ipv46-addr; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=root; \
 last;

#Dec 10 10:33:19 itguxweb2 sshd[29738]: Accepted password for ekwong from 12.34.56.78 port 39852 ssh2
regex=sshd\[\d+\]: Accepted (\S+) for (?!root)(\S+) from ([\d\.]+) port (\d+)\s*(ssh2)?; \
 classification(0).name=SSH Remote user logging; \
 id=1901; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity=low; \
 impact.completion=succeeded; \
 impact.type=user; \
 impact.description=User $2 logged in from $3:$4 using the $1 method; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$3; \
 source.service.port=$4; \
 source.service.protocol=tcp; \
# target.node.address.category=ipv46-addr; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=$2; \
 last

################
# Login failed #
################

#Dec  9 16:00:35 itguxweb2 sshd[24541]: Failed password for root from 12.34.56.78 port 1806
regex=sshd\[\d+\]: Failed (\S+) for root from ([\d\.]+) port (\d+)\s*(ssh2)?; \
 classification(0).name=SSH Remote root logging failed; \
 id=1902; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity=medium; \
 impact.completion=failed; \
 impact.type=admin; \
 impact.description=Someone tried to login as root from $2:$3 using the $1 method; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$2; \
 source.service.port=$3; \
 source.service.protocol=tcp; \
# target.node.address.category=ipv4-addr; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=root; \
 last

#Dec  9 21:29:56 devel5 sshd[17554]: Failed password for akarade from 12.34.56.78 port 4214
regex=sshd\[\d+\]: Failed (\S+) for (?!root)(\S+) from ([\d\.]+) port (\d+)\s*(ssh2)?; \
 classification(0).name=SSH Remote user logging failed; \
 id=1903; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity=medium; \
 impact.completion=failed; \
 impact.type=user; \
 impact.description=Someone tried to login as $2 from $3:$4 using the $1 method; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$3; \
 source.service.port=$4; \
 source.service.protocol=tcp; \
# target.node.address.category=ipv4-addr; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=$2; \
 last

##############################################
# Invalid (not existing) user tried to login #
##############################################

#Dec  9 18:48:29 itguxweb2 sshd[29536]: Failed password for illegal user ROOT from 12.34.56.78 port 2886
regex=sshd\[\d+\]: Illegal user (\S+) from (\S+); \
 classification(0).name=SSH Remote logging failed with an invalid user; \
 id=1904; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity = medium; \
 impact.completion=failed; \
 impact.type=user; \
 impact.description=Someone tried to login with the invalid user "$1" from $2; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$2; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=$1; \
 last

##################################################################################
# User listed in DenyGroups or DenyUsers (sshd_config directives) tried to login #
##################################################################################

# No log sample; please submit
regex=sshd\[\d+\]: User (\S+) not allowed because .*listed in (\w+); \
 classification(0).name=SSH Remote logging failed with a denied user; \
 id=1905; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity = medium; \
 impact.completion=failed; \
 impact.type=user; \
 impact.description=User $1 failed to login because he is listed in $2; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=$1; \
 last

##################################################################
# Sshd did not receive the identification string from the client #
# (maybe a ssh server recognition)                               #
##################################################################

# No log sample; please submit
regex=sshd\[\d+\]: Did not receive identification string from ([\d\.]+); \
 classification(0).name=SSH Server recognition; \
 id=1906; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity = medium; \
 impact.completion=failed; \
 impact.type=recon; \
 impact.description=$1 making probably a server recognition; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$1; \
 source.service.protocol=tcp; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 last

#########################################################################
# Forbidden root logging                                                #
# (directive PermitRootLogin and keyword "no" or "forced-commands-only" #
# of the sshd_config file)                                              #
#########################################################################

# No log sample; please submit
regex=sshd\[\d+\]: ROOT LOGIN REFUSED FROM (\w+); \
 classification(0).name=SSH Remote root logging forbidden; \
 id=1907; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 impact.severity = medium; \
 impact.completion=failed; \
 impact.type=admin; \
 impact.description=Root tried to login while it is forbidden; \
 source.node.address; \
 source.node.address.category=ipv4-addr; \
 source.node.address.address=$1; \
 source.service.protocol=tcp; \
 target.service.port=22; \
 target.service.protocol=tcp; \
 target.user.userid; \
 target.user.userid.name=root; \
 last

