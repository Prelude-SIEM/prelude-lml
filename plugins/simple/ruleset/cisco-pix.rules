#####
#
# Copyright (C) 2003 Gene R Gomez <gene at gomezbrothers dot com>
# Tyco Fire and Security GTS (www.tycofireandsecurity.com)
# All Rights Reserved
#
# This file is part of the Prelude program.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#
#####

#####
#
# The rules included here were developed using a Cisco PIX 525.  Please report
# any inconsistencies on other models to Gene Gomez at the address provided 
# above
#
#####

#Nov  2 18:03:14 pix %PIX-4-400024: IDS:2151 Large ICMP packet from 200.36.129.18 to 12.34.56.78 on interface outside
regex=PIX-4-4000\d\d: IDS:\d+ (.+) from ([\d\.]+) to ([\d\.]+) on interface (\S+); \
 classification(0).name=$1; \
 id=200; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.description=Messages 400000 through 400051 - Cisco Intrusion Detection System signature messages; \
 source(0).interface=$4; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$2; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$3; \
 last

#Nov  2 11:03:52 pix %PIX-6-605005: Login permitted from 12.34.56.78/43610 to inside:90.12.34.56/ssh for user "pix"
regex=PIX-6-605005: Login permitted from ([\d\.]+)\/(\d+) to (\S+):([\d\.]+)\/(\S+) for user "(\S+)"; \
 classification(0).name=Successful PIX login; \
 id=201; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=low; \
 assessment.impact.type=admin; \
 assessment.impact.completion=succeeded; \
 assessment.impact.description=This message appears when a user is authenticated successfully and a management session starts.; \
 source(0).interface=$3; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.port=$2; \
 target(0).interface=$3; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$4; \
 target(0).service.port=$5; \
 target(0).user.category=os-device; \
 target(0).user.userid(0).name=$6; \
 target(0).user.userid(0).type=target-user; \
 last

#Nov  2 11:03:55 pix %PIX-5-111008: User 'enable_1' executed the 'enable' command.
regex=PIX-5-111008: User '(\S+)' executed the 'enable' command; \
 classification(0).name=Successful PIX enable; \
 id=202; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=low; \
 assessment.impact.type=admin; \
 assessment.impact.completion=succeeded; \
 assessment.impact.description=User $1 succesfully enabled; \
 source(0).user.category=os-device; \
 source(0).user.userid(0).name=$1; \
 source(0).user.userid(0).type=current-user; \
 target(0).user.category=os-device; \
 target(0).user.userid(0).name=enable_15; \
 target(0).user.userid(0).type=target-user; \
 last

#Nov  2 11:17:21 pix %PIX-5-111001: Begin configuration: console writing to memory
regex=PIX-5-111001: Begin configuration: (\S+) writing to (\S+); \
 classification(0).name=PIX configuration written to $2; \
 id=203; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=low; \
 assessment.impact.type=admin; \
 assessment.impact.completion=succeeded; \
 assessment.impact.description=Configuration was stored on $2, and the command was executed from $1.; \
 last

#Nov  2 11:17:26 pix %PIX-5-611103: User logged out: Uname: enable_1
regex=PIX-5-611103: User logged out: Uname: (\S+); \
 classification(0).name=PIX logout; \
 id=204; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=low; \
 assessment.impact.type=admin; \
 assessment.impact.completion=succeeded; \
 assessment.impact.description=User $1 logged out; \
 source(0).user.category=os-device; \
 source(0).user.userid(0).name=$1; \
 source(0).user.userid(0).type=current-user; \
 last

#Nov  2 19:13:43 pix %PIX-6-605004: Login denied from 12.34.56.78/44660 to inside:90.12.34.56/ssh for user "frag"
regex=PIX-6-605004: Login denied from ([\d\.]+)\/(\d+) to (\S+):([\d\.]+)\/(\S+) for user "(\S+)"; \
 classification(0).name=Failed PIX login; \
 id=205; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.type=admin; \
 assessment.impact.completion=failed; \
 assessment.impact.description=User $6 failed login; \
 source(0).interface=$3; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.port=$2; \
 target(0).interface=$3; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$4; \
 target(0).service.port=$5; \
 target(0).user.category=os-device; \
 target(0).user.userid(0).name=$6; \
 target(0).user.userid(0).type=target-user; \
 last

#Nov  2 19:14:23 pix %PIX-6-308001: PIX console enable password incorrect for 3 tries (from ssh (remote 12.34.56.78))
regex=PIX-6-308001: PIX (\S+) enable password incorrect for \d+ tries \(from (.+)\); \
 classification(0).name=Failed PIX enable; \
 id=206; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.type=admin; \
 assessment.impact.completion=failed; \
 assessment.impact.description=PIX enable password attempt on the $1 failed from $2; \
 target(0).user.category=os-device; \
 target(0).user.userid(0).name=enable_15; \
 target(0).user.userid(0).type=target-user; \
 last

#Nov 17 11:29:27 pix %PIX-6-315011: SSH session from 12.34.56.78 on interface dmz for user "" disconnected by SSH server, reason: "Invalid format in version string" (0x05)
regex=PIX-6-315011: SSH session from ([\d\.]+) on interface (\S+) for user "" disconnected by SSH server, reason: "Invalid format in version string"; \
 classification(0).name=SSH Server recognition; \
 id=207; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity = medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=recon; \
 assessment.impact.description=$1 probably attempting to determine SSH version; \
 source(0).interface=$2; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.protocol=tcp; \
 target(0).interface=$2; \
 target(0).service.port=22; \
 target(0).service.protocol=tcp; \
 last

#Dec 22 15:55:33 pix %PIX-4-407002: Embryonic limit for through connections exceeded 243/100. 208.252.69.162/55452 to 12.34.56.78(90.12.34.56)/80 on interface outside
regex=PIX-4-407002: Embryonic limit for through connections exceeded \d+\/\d+\. ([\d\.]+)\/(\d+) to ([\d\.]+)\(([\d\.]+)\)\/(\d+) on interface (\S+); \
 classification(0).name=Embryonic connection limit exceeded; \
 id=208; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity = medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=other; \
 assessment.impact.description=The number of connections from $1 over $3 to $4 has exceeded the maximum embryonic limit for that static.; \
 source(0).interface=$6; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.port=$2; \
 source(0).service.protocol=tcp; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$3; \
 target(0).node.address(1).category=ipv4-addr; \
 target(0).node.address(1).address=$4; \
 target(0).service.port=$5; \
 target(0).service.protocol=tcp; \
 last

#Feb  1 00:48:50 pix %PIX-6-106012: Deny IP from 12.34.56.78 to 90.12.34.56, IP options: "Loose Src Routing"
regex=PIX-6-106012: Deny IP from ([\d\.]+) to ([\d\.]+), IP options: "(.+)"; \
 classification(0).name=IP Options: $3; \
 id=209; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=other; \
 assessment.impact.description=An IP packet was seen with IP options.  Because IP options are considered a security risk, the packet was discarded.; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.protocol=tcp; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$2; \
 target(0).service.protocol=tcp; \
 last

#Jan 27 14:51:43 pix %PIX-1-106021: Deny udp reverse path check from 12.34.56.78 to 90.12.34.56 on interface staging
regex=PIX-1-106021: Deny (\w+) reverse path check from ([\d\.]+) to ([\d\.]+) on interface (\S+); \
 classification(0).name=Reverse path check failure; \
 id=210; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=other; \
 assessment.impact.description=Reverse route lookup detected a packet that does not have a source address represented by a route and assumed that it is part of an attack.; \
 source(0).interface=$4; \
 source(0).spoofed=yes; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$2; \
 source(0).service.protocol=$1; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$3; \
 target(0).service.protocol=$1; \
 last

#Feb  1 01:01:28 pix %PIX-4-209003: Fragment database limit of 200 exceeded:  src = 12.34.56.78, dest = 90.12.34.56, proto = icmp, id = 48130
regex=PIX-4-209003: Fragment database limit of \d+ exceeded:  src = ([\d\.]+), dest = ([\d\.]+), proto = (\w+); \
 classification(0).name=Fragment database limit exceeded; \
 id=211; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=other; \
 assessment.impact.description=The IP fragement database limit has been exceeded.  A DoS attack may be in progress.; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.protocol=$3; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$2; \
 target(0).service.protocol=$3; \
 last

#Feb  1 18:16:27 pix %PIX-4-500004: Invalid transport field for protocol=6, from 12.34.56.78/13798 to 90.12.34.56/0
regex=PIX-4-500004: Invalid transport field for protocol=\d+, from ([\d\.]+)\/(\d+) to ([\d\.]+)\/(\d+); \
 classification(0).name=Source or Destination port 0; \
 id=212; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=other; \
 assessment.impact.description=There is an invalid transport number, in which the source or destination port number for a protocol is zero.; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.port=$2; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$3; \
 target(0).service.port=$4; \
 last

#Feb  3 01:47:37 pix %PIX-4-405001: Received ARP response collision from 12.34.56.78/000b.bf5b.9408 on interface outside
regex=PIX-4-405001: Received ARP (request|response) collision from ([\d\.]+)\/([A-Fa-f\d\.]+) on interface (\S+); \
 classification(0).name=ARP $1 mismatch; \
 id=213; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=other; \
 assessment.impact.description=The firewall received an ARP packet, and the MAC address in the packet differs from the ARP cache entry.; \
 source(0).spoofed=yes; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$2; \
 source(0).node.address(1).category=mac; \
 source(0).node.address(1).address=$3; \
 source(0).interface=$4; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$2; \
 last; 

#Jan 25 14:59:33 pix %PIX-3-710003: TCP access denied by ACL from 148.208.247.3/2984 to outside:12.40.199.252/ssh
regex=PIX-3-710003: (TCP|UDP) access denied by ACL from ([\d\.]+)\/(\d+) to (\S+):([\d\.]+)\/(\S+); \
 classification(0).name=Unauthorized admin session attempt; \
 id=214; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=admin; \
 assessment.impact.description=This message appears when the firewall denies an attempt to connect to the interface service from an unauthorized management station.; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$2; \
 source(0).service.port=$3; \
 source(0).service.protocol=$1; \
 source(0).interface=$4; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$5; \
 target(0).service.port=$6; \
 target(0).interface=$4; \
 last

#Mar 15 20:55:18 gtsprodpix %PIX-3-305006: Dst IP is network/broadcast IP, translation creation failed for tcp src prod:10.100.17.27/1586 dst inside:10.100.16.255/445
regex=PIX-3-305006: Dst IP is network/broadcast IP, translation creation failed for (tcp|udp) src (\S+):([\d\.]+)/(\S+) dst (\S+):([\d\.]+)/(\S+); \
 classification(0).name=Broadcast Address Translation Request; \
 id=215; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=recon; \
 assessment.impact.description=The firewall has received a request to assign a static NAT translation for a broadcast address, which is illegal.  This is commonly an indicator of a network mapping attempt.; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$3; \
 source(0).service.port=$4; \
 source(0).service.protocol=$1; \
 source(0).interface=$2; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$6; \
 target(0).service.port=$7; \
 target(0).interface=$5; \
 last

#Mar 24 09:19:42 gtsprodpix %PIX-4-313003: Invalid destination for ICMP error message: ICMP source 12.34.56.78 destination 90.12.34.56 (type 3, code 1) on outside interface.  Original IP payload: ICMP source 1.1.1.1 destination 1.1.1.1 (type 1, code 1).
regex=PIX-4-313003: Invalid destination for ICMP error message: ICMP source ([\d\.]+) destination ([\d\.]+) \(type \d+, code \d+\) on (\S+) interface.; \
 classification(0).name=ICMP Destination/Source Mismatch; \
 id=216; \
 revision=1; \
 classification(0).origin=vendor-specific; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.type=recon; \
 assessment.impact.description=The destination for the ICMP error message is different than the source of the IP packet that induced the ICMP error message.  This could be an active network probe, an attempt to use the ICMP error message as a covert channel, or a misbehaving IP host.; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$1; \
 source(0).service.protocol=icmp; \
 source(0).interface=$3; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$2; \
 target(0).service.protocol=icmp; \
 last


# Events taken from the Cisco System Log Messages List that will need rules
# (include 'attack' || 'intrusion' || 'probe' || 'covert' in description; no log samples):
# %PIX-2-106017: Deny IP due to Land Attack from IP_address to IP_address 
# %PIX-1-106021: Deny protocol reverse path check from source_address to dest_address on interface interface_name 
# %PIX-1-106022: Deny protocol connection spoof from source_address to dest_address on interface interface_name 
# %PIX-1-106101 The number of ACL log deny-flows has reached limit (number).
# %PIX-1-107001: RIP auth failed from IP_address: version=number, type=string, mode=string, sequence=number on interface interface_name 
# %PIX-1-107002: RIP pkt failed from IP_address: version=number on interface interface_name 
# %PIX-4-109017: User at IP_address exceeded auth proxy connection limit (max)
# %PIX-2-201003: Embryonic limit exceeded nconns/elimit for outside_address/outside_port (global_address) inside_address/inside_port on interface interface_name 
# %PIX-3-320001: The subject name of the peer cert is not allowed for connection 
# %PIX-4-402101: decaps: rec'd IPSEC packet has invalid spi for destaddr=dest_address, prot=protocol, spi=number
# %PIX-4-402102: decapsulate: packet missing {AH|ESP}, destadr=dest_address, actual prot=protocol 
# %PIX-4-405002: Received mac mismatch collision from IP_address/mac_address for authenticated host 
# %PIX-7-710005: {TCP|UDP} request discarded from source_address/source_port to interface_name:dest_address/service 
# %PIX-7-710006: protocol request discarded from source_address to interface_name:dest_address
# %PIX-2-106020: Deny IP teardrop fragment (size = number, offset = number) from IP_address to IP_address
# %PIX-4-209004: Invalid IP fragment, size = bytes exceeds maximum size = bytes: src = IP_address, dest = IP_address, proto = protocol, id = number
# %PIX-4-209005: Discard IP fragment set with more than number elements: src = IP_address, dest = IP_address, proto = protocol, id = number 
