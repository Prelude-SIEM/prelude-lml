#####
#
# Copyright (C) 2003 Vincent Glaume
# All Rights Reserved
# Currently supported by Gene R Gomez <gene at gomezbrothers dot com>
#
# This file is part of the Prelude-LML program.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by 
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
#
#####

# I. Starting / stopping squid, and associated services (informational, do not show a real attack)

# starting 
# No log sample; please submit
regex=Starting Squid Cache version ([\w\.]+); \
 classification.text=Proxy started; \
 id=1801; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.completion=succeeded; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid version $1 was started; \
 last

# accepting connections or disabled servicesa
# No log sample; please submit
regex=Accepting HTTP connections at ([\d\.]+), port (\d+), FD (\d+)\.; \
 classification.text=Proxy accepts HTTP; \
 id=1802; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.completion=succeeded; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid listens for incoming HTTP connections on $1:$2, file descriptor #$3; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$1; \
 target(0).service.port=$2; \
 target(0).service.protocol=HTTP; \
 last

# No log sample; please submit
regex=Accepting ICP messages at ([\d\.]+), port (\d+), FD (\d+)\.; \
 classification.text=Proxy accepts ICP; \
 id=1803; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.completion=succeeded; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid listens for incoming ICP messages on $1:$2, file descriptor #$3; \
 target(0).node.address(0).category=ipv4-addr; \
 target(0).node.address(0).address=$1; \
 target(0).service.port=$2; \
 target(0).service.protocol=ICP; \
 last

# No log sample; please submit
regex=Accepting HTCP messages on port (\d+), FD (\d+)\.; \
 classification.text=Proxy accepts HTCP; \
 id=1804; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.completion=succeeded; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid listens for incoming HTCP messages on port $1, file descriptor #$2; \
 target(0).service.port=$1; \
 target(0).service.protocol=HTCP; \
 last

# No log sample; please submit
regex=Accepting WCCP messages on port (\d+), FD (\d+)\.; \
 classification.text=Proxy accepts WCCP; \
 id=1805; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.completion=succeeded; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid listens for incoming WCCP messages on port $1, file descriptor #$2; \
 target(0).service.port=$1; \
 target(0).service.protocol=WCCP; \
 last

# No log sample; please submit
regex=HTCP Disabled\.; \
 classification.text=Proxy started without HTCP; \
 id=1806; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid was invoked without the HTCP service; \
 last

# No log sample; please submit
regex=WCCP Disabled\.; \
 classification.text=Proxy started without WCCP; \
 id=1807; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=info; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid was invoked without the WCCP service; \
 last

# No log sample; please submit
regex=Squid Parent: child process (\d+) exited; \
 classification.text=Proxy stopped; \
 id=1808; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=medium; \
 assessment.impact.type=other; \
 assessment.impact.description=Squid (pid $2) exited; \
 target(0).node.name=$1; \
 target(0).process.name=squid; \
 target(0).process.pid=$2; \
 last


# II. ACL log 
# 1. From /var/log/squid/access.log

# No log sample; please submit
regex=(\d+\.\d+\.\d+\.\d+) .*DENIED/(\d+) (.*); \
 classification.text=Proxy ACL violation attempt; \
 id=1809; \
 revision=1; \
 analyzer(0).name=Squid; \
 analyzer(0).manufacturer=www.squid-cache.org; \
 analyzer(0).class=Proxy; \
 assessment.impact.severity=medium; \
 assessment.impact.completion=failed; \
 assessment.impact.description=Host $1 tried to violate Squid ACL; \
 source(0).node.address(0).category=ipv4-addr; \
 source(0).node.address(0).address=$2; \
 last
